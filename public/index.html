<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carbon Footprint Challenge</title>
  <meta name="description" content="AI-powered carbon footprint guessing game. Test your environmental knowledge!">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // Icons
    const TrendingUp = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const TrendingDown = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
        <polyline points="17 18 23 18 23 12"></polyline>
      </svg>
    );

    const Leaf = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path>
        <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path>
      </svg>
    );

    const Trophy = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
        <path d="M4 22h16"></path>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
      </svg>
    );

    const RotateCcw = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
        <path d="M3 3v5h5"></path>
      </svg>
    );

    const Zap = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
      </svg>
    );

    const STARTING_ACTIVITIES = [
      "Riding a bicycle 1 km",
      "Driving a petrol car 1 km",
      "Drinking a cup of coffee",
      "Eating 1 kg beef",
      "Eating 1 kg chicken",
      "Eating 1 kg vegetables",
      "Boiling 1 liter of water",
      "Using air-conditioning 1 hour",
      "Washing clothes in warm water",
      "Taking a 2-hour flight",
      "Taking a long-haul 10,000 km flight",
      "Buying 1 T-shirt",
      "Producing 1kg of plastic",
      "Composting food waste",
      "Landfilling food waste",
      "Using a laptop for 1 hour",
      "Streaming Netflix 1 hour",
      "Using a phone 1 day",
      "Shipping item by truck 100km",
      "Shipping item by air 1000km",
      "Growing 1kg rice",
      "Growing 1kg wheat"
    ];

    function CarbonGame() {
      const [gameState, setGameState] = useState('menu');
      const [mode, setMode] = useState('higher');
      const [currentActivity, setCurrentActivity] = useState('');
      const [currentValue, setCurrentValue] = useState(0);
      const [score, setScore] = useState(0);
      const [userInput, setUserInput] = useState('');
      const [loading, setLoading] = useState(false);
      const [feedback, setFeedback] = useState('');
      const [isInitializing, setIsInitializing] = useState(false);

      const estimateCarbon = async (activity) => {
        try {
          const response = await fetch('/api/estimate', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ activity })
          });

          const data = await response.json();
          
          if (data.error) {
            console.error('API error:', data.error);
            return -1;
          }

          return data.value;
        } catch (error) {
          console.error('Error estimating carbon:', error);
          return -1;
        }
      };

      const startGame = async (selectedMode) => {
        setIsInitializing(true);
        setMode(selectedMode);
        setScore(0);
        setFeedback('');
        setUserInput('');
        
        const randomActivity = STARTING_ACTIVITIES[Math.floor(Math.random() * STARTING_ACTIVITIES.length)];
        const value = await estimateCarbon(randomActivity);
        
        if (value === -1) {
          setFeedback("Error starting game. Please try again.");
          setIsInitializing(false);
          return;
        }
        
        setCurrentActivity(randomActivity);
        setCurrentValue(value);
        setGameState('playing');
        setIsInitializing(false);
      };

      const handleSubmit = async () => {
        if (!userInput.trim()) return;
        
        setLoading(true);
        setFeedback('');
        
        const newValue = await estimateCarbon(userInput);
        
        if (newValue === -1) {
          setFeedback("âŒ Could not estimate that activity. Try something else!");
          setLoading(false);
          return;
        }
        
        let isCorrect = false;
        
        if (mode === 'higher') {
          isCorrect = newValue > currentValue;
        } else {
          isCorrect = newValue < currentValue;
        }
        
        if (isCorrect) {
          setScore(score + 1);
          setFeedback(`âœ… Correct! ${userInput} = ${newValue.toFixed(2)} kg COâ‚‚e`);
          setCurrentActivity(userInput);
          setCurrentValue(newValue);
          setUserInput('');
        } else {
          setFeedback(`âŒ Wrong! ${userInput} = ${newValue.toFixed(2)} kg COâ‚‚e (needed ${mode === 'higher' ? '>' : '<'} ${currentValue.toFixed(2)})`);
          setGameState('gameover');
        }
        
        setLoading(false);
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !loading && userInput.trim()) {
          handleSubmit();
        }
      };

      const resetGame = () => {
        setGameState('menu');
        setScore(0);
        setFeedback('');
        setUserInput('');
      };

      if (gameState === 'menu') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-4">
            <div className="max-w-2xl w-full bg-white rounded-3xl shadow-2xl p-8">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-green-100 rounded-full mb-4">
                  <div className="w-16 h-16 text-green-600 inline-flex items-center justify-center">
                    <Leaf />
                  </div>
                </div>
                <h1 className="text-4xl font-bold text-gray-800 mb-2">
                  Carbon Footprint Challenge
                </h1>
                <p className="text-gray-600 text-lg">
                  Guess activities with higher or lower COâ‚‚ emissions!
                </p>
              </div>
              
              <div className="space-y-4">
                <button
                  onClick={() => startGame('higher')}
                  disabled={isInitializing}
                  className="w-full bg-gradient-to-r from-red-500 to-orange-500 text-white py-6 rounded-2xl font-bold text-xl hover:shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 flex items-center justify-center gap-3"
                >
                  <TrendingUp />
                  HIGHER Mode
                </button>
                
                <button
                  onClick={() => startGame('lower')}
                  disabled={isInitializing}
                  className="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-6 rounded-2xl font-bold text-xl hover:shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 flex items-center justify-center gap-3"
                >
                  <TrendingDown />
                  LOWER Mode
                </button>
              </div>
              
              {isInitializing && (
                <div className="text-center mt-6 text-gray-600">
                  <span className="inline-block animate-pulse mr-2"><Zap /></span>
                  Initializing game...
                </div>
              )}
              
              <div className="mt-8 p-6 bg-blue-50 rounded-2xl">
                <h3 className="font-bold text-gray-800 mb-2">How to Play:</h3>
                <ul className="text-sm text-gray-600 space-y-1">
                  <li>ðŸ”¼ <strong>HIGHER:</strong> Guess activities with MORE emissions</li>
                  <li>ðŸ”½ <strong>LOWER:</strong> Guess activities with LESS emissions</li>
                  <li>ðŸŽ¯ Chain correct guesses to build your score!</li>
                  <li>ðŸ’¡ Be specific (e.g., "driving 50km" vs "driving")</li>
                </ul>
              </div>
            </div>
          </div>
        );
      }

      if (gameState === 'gameover') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-50 to-red-50 flex items-center justify-center p-4">
            <div className="max-w-2xl w-full bg-white rounded-3xl shadow-2xl p-8 text-center">
              <div className="inline-block p-4 bg-red-100 rounded-full mb-4">
                <div className="w-16 h-16 text-red-600 inline-flex items-center justify-center">
                  <Trophy />
                </div>
              </div>
              
              <h1 className="text-4xl font-bold text-gray-800 mb-2">Game Over!</h1>
              <p className="text-6xl font-bold text-red-600 my-6">{score}</p>
              <p className="text-xl text-gray-600 mb-2">Correct Guesses</p>
              
              {feedback && (
                <div className="my-6 p-4 bg-red-50 rounded-xl text-gray-700">
                  {feedback}
                </div>
              )}
              
              <button
                onClick={resetGame}
                className="mt-6 bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:shadow-lg transform hover:scale-105 transition-all inline-flex items-center justify-center gap-2"
              >
                <RotateCcw />
                Play Again
              </button>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
          <div className="max-w-4xl mx-auto py-8">
            <div className="flex justify-between items-center mb-6">
              <div className="flex items-center gap-3">
                <div className={`px-6 py-3 rounded-full font-bold text-lg ${
                  mode === 'higher' 
                    ? 'bg-gradient-to-r from-red-500 to-orange-500 text-white' 
                    : 'bg-gradient-to-r from-green-500 to-teal-500 text-white'
                }`}>
                  <span className="inline-flex items-center gap-2">
                    {mode === 'higher' ? <TrendingUp /> : <TrendingDown />}
                    {mode.toUpperCase()}
                  </span>
                </div>
                <div className="bg-white px-6 py-3 rounded-full shadow-lg">
                  <Trophy />
                  <span className="font-bold text-gray-800 ml-2">Score: {score}</span>
                </div>
              </div>
              <button
                onClick={resetGame}
                className="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-full transition-colors"
              >
                <RotateCcw />
              </button>
            </div>

            <div className="bg-white rounded-3xl shadow-2xl p-8 mb-6">
              <div className="text-center">
                <p className="text-sm text-gray-500 uppercase tracking-wide mb-2">Current Activity</p>
                <h2 className="text-3xl font-bold text-gray-800 mb-4">{currentActivity}</h2>
                <div className="inline-block bg-gradient-to-r from-blue-100 to-purple-100 px-8 py-4 rounded-2xl">
                  <p className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
                    {currentValue.toFixed(2)} <span className="text-2xl">kg COâ‚‚e</span>
                  </p>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-3xl shadow-2xl p-8">
              <p className="text-center text-lg text-gray-700 mb-4 font-semibold">
                Guess an activity with {mode === 'higher' ? 'HIGHER' : 'LOWER'} carbon footprint:
              </p>
              
              <div className="space-y-4">
                <input
                  type="text"
                  value={userInput}
                  onChange={(e) => setUserInput(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="e.g., Eating 1kg chicken, Flying 500km..."
                  disabled={loading}
                  className="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-2xl focus:border-blue-500 focus:outline-none disabled:bg-gray-100"
                />
                
                <button
                  onClick={handleSubmit}
                  disabled={loading || !userInput.trim()}
                  className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-2xl font-bold text-lg hover:shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                >
                  {loading ? (
                    <span className="inline-flex items-center gap-2">
                      <span className="animate-pulse"><Zap /></span>
                      Calculating...
                    </span>
                  ) : (
                    'Submit Guess'
                  )}
                </button>
              </div>

              {feedback && (
                <div className={`mt-4 p-4 rounded-2xl text-center font-semibold ${
                  feedback.includes('âœ…') 
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-red-100 text-red-800'
                }`}>
                  {feedback}
                </div>
              )}
            </div>

            <div className="mt-6 text-center text-sm text-gray-600">
              ðŸ’¡ Tip: Be specific with quantities and distances for better results!
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<CarbonGame />, document.getElementById('root'));
  </script>
</body>
</html>
